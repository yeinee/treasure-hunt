<div class="container">
  <div class="container" id="main">
    <div class="container">
      <!-- 프로필 -->
      <h4>&nbsp;&nbsp;&nbsp;
        <img src="http://api.randomuser.me/portraits/med/men/20.jpg" style="border-radius:5px" width="28px" height="28px">
        &nbsp;&nbsp;&nbsp;
        <span class="glyphicon glyphicon-star"></span>&nbsp;<%= @user_rating %>
        &nbsp;
        <span class="glyphicon glyphicon-gift"></span>&nbsp;&nbsp;<%= @post.user.posts.count %>
      </h4>
      <!-- 프로필 끝 -->
      <!-- 내용 -->
      <div class="jumbotron" >
        <% unless @attachment.nil? %>
          <div style=<%="height:300px;border-radius:1%;background-size:cover!important;background:url(\"#{@attachment.file}\");"%>></div>
        <% end %>
        <h1><%= @post.title %></h1>
        <p class="lead"><%= @post.description %></p><br>
        <p><a class="btn btn-lg btn-success" role="button" href="#questionModal" data-toggle="modal">심심한데 문제나 풀어볼까..</a></p>
      </div>
      <!-- 내용 끝 -->

      <!-- 포스트 정보 -->
      <div class="row marketing">
        <div class="col-lg-12">
          <!--진행상황-->
          <div>
            <h4 style="margin-top:0px"><%= @post.questions.count %> 문제가 있긴 한데, <%= @engaging_users.count %> 명이 도전 중이네... </h4>
            <div class="progress progress-striped active">
              <% conquered = @post.engage_states.where(is_valid: true)%>
              <% if conquered.present?%>
                <% conquered = conquered.order(:question_number).last.question_number %>
                <% conquered_ratio = conquered*100.to_f/@post.questions.count %>
                <div class="progress-bar" style=<%="width:#{conquered_ratio}%"%>> 정복률 : <%= conquered_ratio %> % </div>
              <% else %>
                <div class="progress-bar" style="width:0%"></div>
              <% end %>

            </div>
          </div>
          <!--진행상황 끝-->

          <hr>

          <!--리플라이 달기-->
          <div>
            <% if user_signed_in? %>
              <%= render :partial => 'replies/form', :object => @reply %>
            <% else %>
              <div class="input-group text-center" style="width:100%;">
                <input class="form-control input-md" placeholder="로그인 후 댓글 기능을 이용하실 수 있습니다. 약 오르지?" readonly>
              </div>
            <% end %>
          </div>
          <!--리플라이 달기 끝-->
          <!--리플라이 내용  -->
          <div style="margin-top:10px">
            <% @post.replies.each do |r| %>
              <div class="panel panel-primary" style="margin-bottom:6px">
                <div class="panel-body">
                  <img src="http://api.randomuser.me/portraits/med/men/20.jpg" style="border-radius:5px" width="28px" height="28px">
                  &nbsp; <%= r.user.email %> : <%= r.content %>

                  <!-- 리플라이 수정 권한 부여 -->
                  <%if current_user == r.user%>
                    <a data-method="delete" class="pull-right" href=<%= "/replies/"+r.id.to_s %>>
                      <span class="glyphicon glyphicon-remove" style="color:red" aria-hidden="true"></span>
                    </a>
                    <a class="pull-right" href=<%= "/replies/"+r.id.to_s+"/edit" %>>
                      <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>&nbsp
                    </a>
                  <% end %>
                  <!-- 리플라이 수정 권한 부여 끝 -->
                </div>
              </div>
            <% end %>
          </div>
          <!--리플라이 내용 끝-->
        </div>
      </div>
      <!--포스트 정보 끝-->
    </div>
  </div>
</div>
<p id="notice"><%= notice %></p>

<p>
<strong>User:</strong>
<%= @post.user %>
</p>

<p>
<strong>Title:</strong>
<%= @post.title %>
</p>

<p>
<strong>Description:</strong>
<%= @post.description %>
</p>

<p>
<strong>Is complete:</strong>
<%= @post.is_complete %>
</p>

<p>
<strong>Hunter:</strong>
<%= @post.hunter %>
</p>

<%= image_tag @post.attachments.first.file rescue nil %>

<%= link_to 'Edit', edit_post_path(@post) %> |
<%= link_to 'Back', posts_path %>


<!--QuestionModal-->
<% if user_signed_in? %>
<div id="questionModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog">
  <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <br>
        <center><h3>문제 <%= @current_question.number %></h3>
          <h5><%= @current_question.content %></h5>
        </center>
      </div>
      <div class="modal-body form col-md-12 center-block">
        <%= render :partial => 'engage_states/form', :object => @engage_state %>
      </div>
      <div class="modal-footer">
        <div class="col-md-12">
        </div>
      </div>
  </div>
  </div>
</div>
<% end %>
